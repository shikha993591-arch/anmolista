<!DOCTYPE html>
<html>
<head>
  <title>Chat</title>
  <link rel="stylesheet" href="style.css">
</head>
<body class="dark">

<div class="chat-header">
  <span onclick="back()">←</span>
  <b id="name"></b>
</div>

<div class="messages" id="msgs"></div>

<div class="input-bar">
  <input id="msg" placeholder="Type message">
  <button onclick="send()">➤</button>
</div>

<script src="firebase.js"></script>
<script>
const me = localStorage.getItem("user");
const other = localStorage.getItem("chatWith");
document.getElementById("name").innerText = other;

const chatId = [me, other].sort().join("_");
const ref = db.collection("chats").doc(chatId);

ref.set({ users:[me,other] },{merge:true});

ref.collection("messages")
.orderBy("time")
.onSnapshot(snap=>{
  const box=document.getElementById("msgs");
  box.innerHTML="";
  snap.forEach(d=>{
    const m=d.data();
    const div=document.createElement("div");
    div.className = m.from===me?"me":"other";
    div.innerText=m.text;
    box.appendChild(div);
  });
});

function send(){
  const t=document.getElementById("msg");
  if(!t.value) return;
  ref.collection("messages").add({
    from:me,
    text:t.value,
    time:Date.now()
  });
  t.value="";
}

function back(){ window.location.href="home.html"; }
</script>

</body>
</html>
